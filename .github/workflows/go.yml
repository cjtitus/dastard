# This workflow will build a golang project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-go

name: Go

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]
  release:
    types: [created]

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Install deps (can we eliminate libsodium?)
      run: sudo apt-get install -y libsodium-dev libczmq-dev git gcc pkg-config

    - name: Set up Go
      uses: actions/setup-go@v3
      with:
        go-version: 1.19
      
    - name: make static
      run: make static
      
    - name: debugging
      run: ls;ls cmd;ls cmd/dastard
   
    - name: Test
      run: go test -v ./...
      
    - name: Publish GitHub Release Artifacts
      if: github.event_name == 'release' && github.event.action == 'created'
      uses: SierraSoftworks/gh-releases@v1.0.7
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        overwrite: 'true'
        files: dastard

